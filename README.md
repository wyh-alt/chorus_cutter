# 副歌剪辑器 (Chorus Cutter)

一个功能强大的音频副歌剪辑工具，支持批量处理、多种导出模式和友好的图形界面。

## 功能特性

✨ **核心功能**
- 🎵 根据 Excel 表格自动匹配并剪辑音频副歌部分
- 📊 支持多种时间格式：`mm:ss`、`hh:mm:ss`、秒数等
- 🎯 三种匹配策略：伴奏ID优先、按歌名、模糊匹配
- 📦 两种导出模式：整段副歌、分段副歌（前段+后段）
- 🖱️ 完整的拖拽支持（文件夹、音频文件、Excel文件）
- 📈 实时进度显示和处理日志
- 💾 导出处理结果报告（Excel/CSV格式）

## 安装步骤

### 1. 安装 Python 环境

确保已安装 **Python 3.8 或更高版本**。

检查 Python 版本：
```bash
python --version
```

### 2. 安装 Python 依赖

```bash
pip install -r requirements.txt
```

或手动安装：
```bash
pip install PyQt6 pandas pydub openpyxl
```

### 3. 安装 ffmpeg（必需）

#### Windows
1. 从 [ffmpeg 官网](https://ffmpeg.org/download.html) 下载 Windows 版本
2. 解压到任意目录（例如 `C:\ffmpeg`）
3. 将 `bin` 目录添加到系统 PATH 环境变量
4. 验证安装：
   ```bash
   ffmpeg -version
   ```

#### macOS
```bash
brew install ffmpeg
```

#### Linux (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install ffmpeg
```

#### Linux (CentOS/RHEL)
```bash
sudo yum install ffmpeg
```

## 使用方法

### 启动程序

```bash
python chorus_cutter.py
```

### 操作步骤

1. **加载音频文件**
   - 点击"浏览"按钮选择音频目录
   - 或直接拖拽文件夹/音频文件到输入框

2. **加载剪切时间表格**
   - 点击"加载"按钮选择 Excel 或 CSV 文件
   - 或直接拖拽表格文件到输入框

3. **选择输出目录**
   - 点击"浏览"选择输出文件夹

4. **配置处理选项**
   - **导出格式**：wav 或 mp3
   - **匹配策略**：
     - 伴奏ID优先：优先用伴奏ID匹配，失败则用歌名
     - 按歌名：仅使用歌名匹配
     - 模糊匹配：允许部分匹配
   - **导出模式**：
     - ✅ 整段副歌：导出完整副歌（开始→结束）
     - ✅ 分段副歌：导出前段（开始→剪切点）和后段（剪切点→结束）
   - **其他选项**：
     - 覆盖已存在文件（默认自动重命名）
     - 处理失败时跳过

5. **开始处理**
   - 点击"开始处理"按钮
   - 可随时点击"停止"按钮中断处理

6. **导出结果**
   - 处理完成后，点击"导出结果"保存处理报告

## Excel 表格格式

### 必需列（至少包含以下列之一作为标识）

| 列名 | 说明 | 示例 |
|------|------|------|
| 伴奏ID | 音频文件的唯一标识 | `12345` |
| 歌名 | 歌曲名称 | `夏日微光` |

### 时间列（必需）

| 列名 | 说明 | 格式示例 |
|------|------|----------|
| 副歌开始时间 | 副歌起始时间 | `1:15` 或 `75` 或 `0:01:15` |
| 副歌结束时间 | 副歌结束时间 | `1:45` 或 `105` |
| 段落剪切时间 | 分段点（可选） | `1:30` 或 `90` |

### 其他列（可选）

| 列名 | 说明 |
|------|------|
| 歌手 | 演唱者 |
| 副歌调号 | 音乐调号 |
| 副歌速度 | BPM |
| 性别 | 演唱者性别 |

### 支持的列名别名

程序支持中英文列名：
- `伴奏ID` / `accompaniment_id` / `id`
- `歌名` / `song_name` / `name`
- `副歌开始时间` / `chorus_start` / `start_time`
- `副歌结束时间` / `chorus_end` / `end_time`
- `段落剪切时间` / `split_time` / `cut_time`

### 示例 Excel 内容

| 伴奏ID | 歌名 | 歌手 | 副歌开始时间 | 副歌结束时间 | 段落剪切时间 |
|--------|------|------|--------------|--------------|--------------|
| 12345 | 夏日微光 | 张三 | 1:15 | 1:45 | 1:30 |
| 12346 | 月光森林 | 李四 | 0:58 | 1:28 | 1:13 |
| 12347 | 星空物语 | 王五 | 75 | 105 | 90 |

## 输出文件命名规则

### 整段副歌模式
```
<伴奏ID>-整段副歌.wav
```
例如：`12345-整段副歌.wav`

### 分段副歌模式
```
<伴奏ID>-前段副歌.wav
<伴奏ID>-后段副歌.wav
```
例如：
- `12345-前段副歌.wav`
- `12345-后段副歌.wav`

### 同时勾选两种模式
每首歌输出 3 个文件：
- `12345-整段副歌.wav`
- `12345-前段副歌.wav`
- `12345-后段副歌.wav`

> 💡 **注意**：如果伴奏ID缺失，将使用歌名代替。文件名会自动清理非法字符。

## 支持的音频格式

### 输入格式
- MP3 (`.mp3`)
- WAV (`.wav`)
- FLAC (`.flac`)
- M4A (`.m4a`)
- OGG (`.ogg`)
- WMA (`.wma`)
- AAC (`.aac`)

### 输出格式
- WAV (无损)
- MP3 (320kbps)

## 常见问题

### Q: 提示"未检测到 ffmpeg"怎么办？
**A:** 需要安装 ffmpeg 并添加到系统 PATH。参考上方"安装 ffmpeg"部分。

### Q: Excel 读取失败？
**A:** 请检查：
- Excel 文件格式是否为 `.xlsx`、`.xls` 或 `.csv`
- 文件是否被其他程序占用
- 表头列名是否正确（参考上方表格格式）

### Q: 音频匹配失败？
**A:** 请确保：
- 音频文件名与 Excel 中的"伴奏ID"或"歌名"一致
- 尝试使用"模糊匹配"策略
- 检查文件名是否有多余的空格或特殊字符

### Q: 处理速度慢？
**A:** 处理速度取决于：
- 音频文件大小和数量
- 硬盘读写速度
- 输出格式（MP3 编码比 WAV 慢）

### Q: 导出 MP3 格式失败？
**A:** 确保 ffmpeg 正确安装，MP3 编码需要 ffmpeg 支持。

### Q: 文件已存在怎么办？
**A:** 
- 不勾选"覆盖已存在文件"：自动重命名为 `文件名(1).wav`、`文件名(2).wav` 等
- 勾选"覆盖已存在文件"：直接覆盖原文件

## 技术栈

- **GUI框架**: PyQt6
- **数据处理**: pandas
- **音频处理**: pydub (基于 ffmpeg)
- **Excel读写**: openpyxl

## 许可证

MIT License

## 更新日志

### v1.0 (2024-11-14)
- ✅ 首次发布
- ✅ 支持整段和分段副歌剪辑
- ✅ 完整的拖拽功能
- ✅ 实时进度和日志显示
- ✅ 导出处理结果报告

## 贡献

欢迎提交 Issue 和 Pull Request！

## 联系方式

如有问题或建议，请提交 Issue。

---

**享受音乐剪辑的乐趣！** 🎵✨

